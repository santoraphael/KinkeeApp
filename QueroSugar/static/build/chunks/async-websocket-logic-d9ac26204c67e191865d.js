/*! {Â© 2016 - 2020 Tinder, Inc., ALL RIGHTS RESERVED} */
(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{1506:function(e,t,n){"use strict";n.r(t),n.d(t,"websocketRootSaga",(function(){return ue}));var r=n(1),a=n.n(r),c=n(34),u=n.n(c),o=n(6),s=n.n(o),i=n(46),b=n.n(i),p=n(106),O=n(0),d=n(8),l=n(109),j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(n,r){var a=new FileReader;switch(a.onloadend=function(){n(a.result)},a.onerror=function(e){r(e)},t){case 0:a.readAsArrayBuffer(e);break;case 1:a.readAsBinaryString(e);break;case 2:a.readAsDataURL(e);break;case 3:default:a.readAsText(e)}}))},f=n(13),m=n(20),g=n(10),x=n(15),v=n(74),h=n(330),w=n(98),k=n(88),y=n(4),E=n(21),T=n(211),S=n(87),I=n(230),R=n(557),D=n(156),_=n(371);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=regeneratorRuntime.mark($),K=regeneratorRuntime.mark(ee),B=regeneratorRuntime.mark(te),F=regeneratorRuntime.mark(ne),W=regeneratorRuntime.mark(re),A=regeneratorRuntime.mark(ae),U=regeneratorRuntime.mark(ce),G=d.a.websocket,M=G.host,J=G.reconnectJitter,L=void 0===J?.2:J,H=G.maxRetryInterval,Y=G.baseRetryInterval,q=G.pingInterval,Q=G.pingTimeout,V=G.disconnectOnIdle;function X(e){return"".concat(M,"/ws?token=").concat(e)}function z(e){return Z.apply(this,arguments)}function Z(){return(Z=u()(regeneratorRuntime.mark((function e(t){var n,r,a,c,o,i,O=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O.length>1&&void 0!==O[1]?O[1]:{},r=n.pingInterval,a=void 0===r?q:r,e.next=3,Object(l.b)();case 3:return c=e.sent,o=s()(c,["keepalive","ClientData"]),i=o.encode({ping:""}).finish(),e.abrupt("return",Object(p.d)((function(e){var n,r,c=new WebSocket(X(t));return c.onopen=function(){var t=Date.now();e({type:"__WEBSOCKET_HOOK__",clientDataSchema:o,ping:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q;c.send(i),t&&!n&&(n=setTimeout((function(){n=null,e(Object(R.g)())}),t))},pong:function(){clearTimeout(n),n=null},send:function(e){c.send(e)}}),e(Object(R.b)(t)),a&&(r=setInterval((function(){e(Object(R.f)())}),a))},c.onmessage=(function(){var t=u()(regeneratorRuntime.mark((function t(n){var r,a,c,u,s,i,b,p,O,d,f,m,x,v,w,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(n.data);case 2:r=t.sent,a=o.decode(new Uint8Array(r)).toJSON(),c=o.toObject(a,{defaults:!0}),u=!1,s=c.meta,i=c.nudge,b=c.pong,p=c.typingIndicator,O=c.update,d=c.emailCollectionSettings,f=Object(l.d)(s&&s.startTime),m=Object(l.d)(s&&s.upstreamTime),x=Date.now(),Object(g.F)("decoded websocket object",c),i&&(u=!0,e(Object(R.a)(i,{startTime:f,upstreamTime:m},x))),b&&(u=!0,e(Object(R.h)())),p&&(u=!0,v=p.matchId,w=p.toUserId,y=p.sentTime,e(Object(h.b)(v,w,null,null,null,y))),O&&Object(g.F)("we are not handling updates yet",c),d&&(u=!0,e(Object(k.e)(d))),u||(Object(g.F)("unhandled message",c),e(Object(R.e)(c)));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}})(),c.onclose=function(t){clearTimeout(n),clearInterval(r),e(Object(R.c)(t))},function(){Object(g.F)("closing websocket"),clearTimeout(n),clearInterval(r),c.onclose=b.a,c.close()}})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,n){var r,a;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(Object(g.F)("error Code ".concat(e,", failed attempt ").concat(t)),!(e>=1e3)){c.next=4;break}return c.next=4,Object(O.h)(Object(E.a)(y.Kc,{closeCode:e,previouslyEstablished:n}));case 4:return r=Math.pow(2,t)*Y,a=Math.min(H,r*(1-(u=L)+2*u*Math.random())),Object(g.F)("reconnecting in ".concat(Math.round(a),"ms")),c.next=9,Object(p.c)(a);case 9:case"end":return c.stop()}var u}),P)}function ee(){var e,t,n=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:0,Object(g.F)("connecting..."),r.next=4,Object(O.d)(te,e);case 4:if(t=r.sent){r.next=9;break}return r.next=8,Object(O.d)(ee,e+1);case 8:return r.abrupt("return",r.sent);case 9:return Object(g.F)("connected!"),r.abrupt("return",t);case 11:case"end":return r.stop()}}),K)}function te(){var e,t,n,r=arguments;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:0,a.prev=1,a.next=4,Object(O.d)(Object(f.q)(f.o,"getWebsocketToken"));case 4:return t=a.sent,n=s()(t,["token"]),a.next=8,Object(O.d)(z,n);case 8:return a.abrupt("return",a.sent);case 11:return a.prev=11,a.t0=a.catch(1),a.next=15,Object(O.d)($,a.t0.status,e);case 15:return a.abrupt("return",null);case 16:case"end":return a.stop()}}),B,null,[[1,11]])}function ne(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.close(),t.next=3,Object(O.h)(Object(R.c)());case 3:case"end":return t.stop()}}),F)}function re(e,t,n){var r,a,c;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:u.t0=n.type,u.next=u.t0===w.SEND_TYPING_PULSE?3:13;break;case 3:return r=s()(n.payload,"matchId"),a=s()(n.payload,"toUserId"),c=e&&e.encode({typingIndicator:{matchId:r,sentTime:s()(n.payload,"clientTime",Object(l.a)(Date.now())),toUserId:a}}).finish(),u.next=8,Object(O.d)(t,c);case 8:return u.next=10,Object(O.h)(Object(E.a)(y.Q,s()(n.payload,"eventData")));case 10:return u.next=12,Object(O.h)(Object(E.a)(S.a,N({type:I.n,subtype:I.g,matchId:r,otherId:a},s()(n.payload,"eventData"))));case 12:case 13:return u.abrupt("break",14);case 14:case"end":return u.stop()}}),W)}function ae(){var e,t,n,r,a,c,u,o,i,b,p,d,l,j,f,m,h;return regeneratorRuntime.wrap((function(k){for(;;)switch(k.prev=k.next){case 0:return e=0,k.next=3,Object(O.d)(ee,e);case 3:return t=k.sent,n=!1,o=Array.from(x.b).concat([v.d]),k.next=8,Object(O.m)(o,ne,t);case 8:return k.next=10,Object(O.m)([w.SEND_TYPING_PULSE],(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return re.apply(void 0,[r,u].concat(t))}));case 10:k.prev=10;case 11:return k.next=14,Object(O.l)(t);case 14:if("__WEBSOCKET_HOOK__"!==(i=k.sent).type){k.next=21;break}return r=i.clientDataSchema,a=i.ping,c=i.pong,u=i.send,k.abrupt("continue",11);case 21:return b=i.type,p=i.payload,k.next=24,Object(O.h)(i);case 24:Object(g.F)(b),k.t0=b,k.next=k.t0===D.WEBSOCKET_CONNECTED?28:k.t0===D.WEBSOCKET_MESSAGE?36:k.t0===D.WEBSOCKET_PING?37:k.t0===D.WEBSOCKET_PING_TIMEOUT?40:k.t0===D.WEBSOCKET_PONG?50:k.t0===D.NUDGE_RECEIVED?53:k.t0===D.WEBSOCKET_DISCONNECTED?59:68;break;case 28:return d=e,n=!0,e=0,k.next=33,Object(O.h)(Object(T.i)({isNudge:!1}));case 33:return k.next=35,Object(O.h)(Object(E.a)(y.Lc,{connected:!0,connectAttempts:d}));case 35:case 36:return k.abrupt("break",69);case 37:return k.next=39,Object(O.d)(a);case 39:return k.abrupt("break",69);case 40:return t.close(),e+=1,null,k.next=45,Object(O.d)($,null,e,n);case 45:return n=!1,k.next=48,Object(O.d)(ee,e);case 48:return t=k.sent,k.abrupt("break",69);case 50:return k.next=52,Object(O.d)(c);case 52:return k.abrupt("break",69);case 53:return l=p.nudge,j=p.startTime,f=p.upstreamTime,m=p.clientTime,k.next=56,Object(O.h)(Object(T.i)({isNudge:!0}));case 56:return k.next=58,Object(O.h)(Object(E.a)(y.Mc,{nudgeType:l.type,startDelta:m-j,upstreamDelta:m-f}));case 58:return k.abrupt("break",69);case 59:return e+=1,h=s()(p,["error","code"])||400,k.next=63,Object(O.d)($,h,e,n);case 63:return n=!1,k.next=66,Object(O.d)(ee,e);case 66:return t=k.sent,k.abrupt("break",69);case 68:return k.abrupt("break",69);case 69:k.next=11;break;case 71:return k.prev=71,k.next=74,Object(O.f)();case 74:if(!k.sent){k.next=77;break}return k.next=77,Object(O.d)(ne,t);case 77:return k.finish(71);case 78:case"end":return k.stop()}}),A,null,[[10,,71,78]])}function ce(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(O.j)(_.a);case 2:if(!n.sent){n.next=5;break}return Object(g.F)("CONNECTED WEBSOCKET EXISTS"),n.abrupt("return");case 5:return n.next=7,Object(O.g)(ae);case 7:if(t=n.sent,!V){n.next=17;break}return n.next=11,Object(O.l)(x.a);case 11:return n.next=13,Object(O.e)(t);case 13:return n.next=15,Object(O.l)(x.c);case 15:return n.next=17,Object(O.g)(ce,e);case 17:case"end":return n.stop()}}),U)}var ue=Object(m.e)(ce,{name:"websocketRootSaga"})}}]);